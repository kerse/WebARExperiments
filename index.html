<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AR Plane Detection</title>
  <!-- Подключаем three.js и three.ar.js -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.126.1/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three.ar.js@latest/dist/three.ar.min.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
  <script>
    // Основная инициализация
    let scene, camera, renderer, arView, reticle, box;

    THREE.ARUtils.getARDisplay().then(init);

    function init(display) {
      // Инициализация сцены
      scene = new THREE.Scene();

      // Инициализация WebGLRenderer
      renderer = new THREE.WebGLRenderer({ alpha: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(window.devicePixelRatio); // Устанавливаем правильное соотношение пикселей
      document.body.appendChild(renderer.domElement);

      // Инициализация ARView
      arView = new THREE.ARView(display, renderer);

      // Настройка камеры AR
      camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.01, 20); 
      scene.add(camera);

      // Создание reticle (сетка для размещения объектов)
      reticle = new THREE.ARReticle(display);
      scene.add(reticle);

      // Загрузка модели (здесь используем твою модель skull.glb)
      const loader = new THREE.GLTFLoader();
      loader.load('skull.glb', function(gltf) {
        box = gltf.scene;
        box.scale.set(0.5, 0.5, 0.5); // Масштабирование модели
        box.visible = false; // Скрыта до обнаружения плоскости
        scene.add(box);
      });

      // Основной цикл
      display.requestAnimationFrame(update);
    }

    function update(time) {
      // Обновление камеры и сцены
      reticle.update();
      arView.render();
      renderer.render(scene, camera);

      // Если плоскость обнаружена, размещаем модель
      if (reticle.visible && box) {
        box.position.setFromMatrixPosition(reticle.matrix);
        box.visible = true;
      }

      requestAnimationFrame(update);
    }

    // Обработка изменения размера окна
    window.addEventListener('resize', function() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
